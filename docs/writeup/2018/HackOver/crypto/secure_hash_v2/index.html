<!DOCTYPE HTML><html lang=""><head><meta charset="UTF-8"><meta content="text/html; charset=utf-8"http-equiv="Content-Type"><title>crypto - secure_hash_v2 Â· GitBook</title><meta content="IE=edge"http-equiv="X-UA-Compatible"/><meta content=""name="description"><meta content="GitBook 3.2.3"name="generator"><link href="../../../../../gitbook/style.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-katex/katex.min.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-disqus/plugin.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-writeup-utils/plugin.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-highlight/website.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-search/search.css"rel="stylesheet"><link href="../../../../../gitbook/gitbook-plugin-fontsettings/website.css"rel="stylesheet"><meta content="true"name="HandheldFriendly"/><meta content="width=device-width,initial-scale=1,user-scalable=no"name="viewport"><meta content="yes"name="apple-mobile-web-app-capable"><meta content="black"name="apple-mobile-web-app-status-bar-style"><link href="../../../../../gitbook/images/apple-touch-icon-precomposed-152.png"rel="apple-touch-icon-precomposed"sizes="152x152"><link href="../../../../../gitbook/images/favicon.ico"rel="shortcut icon"type="image/x-icon"><link href="../../rev/flagmaker/"rel="next"/><link href="../oblivious/"rel="prev"/></head><body><div class="book"><div class="book-summary"><div role="search"id="book-search-input"><input placeholder="Type to search"type="text"/></div><nav role="navigation"><ul class="summary"><li class="chapter"data-level="1.1"data-path="../../../../../"><a href="../../../../../">Introduction</a></li><li class="header">Writeups</li><li class="header">2018</li><li class="chapter"data-level="3.1"><span>Hackover</span><ul class="articles"><li class="chapter"data-level="3.1.1"data-path="../oblivious/"><a href="../oblivious/">crypto - oblivious</a></li><li class="chapter active"data-level="3.1.2"data-path="./"><a href="./">crypto - secure_hash_v2</a></li><li class="chapter"data-level="3.1.3"data-path="../../rev/flagmaker/"><a href="../../rev/flagmaker/">rev - flagmaker</a></li></ul></li><li class="chapter"data-level="3.2"><span>Teaser Dragon</span><ul class="articles"><li class="chapter"data-level="3.2.1"data-path="../../../TeaserDragon/rev/Chains of trust/"><a href="../../../TeaserDragon/rev/Chains of trust/">rev - Chains of trust</a></li></ul></li><li class="chapter"data-level="3.3"><span>Defcamp</span><ul class="articles"><li class="chapter"data-level="3.3.1"data-path="../../../defcamp/rev/validator/"><a href="../../../defcamp/rev/validator/">rev - validator</a></li><li class="chapter"data-level="3.3.2"data-path="../../../defcamp/rev/memsome/"><a href="../../../defcamp/rev/memsome/">rev - memsome</a></li><li class="chapter"data-level="3.3.3"data-path="../../../defcamp/web/secops/"><a href="../../../defcamp/web/secops/">web - secops</a></li><li class="chapter"data-level="3.3.4"data-path="../../../defcamp/web/chat/"><a href="../../../defcamp/web/chat/">web - chat</a></li><li class="chapter"data-level="3.3.5"data-path="../../../defcamp/misc/voices/"><a href="../../../defcamp/misc/voices/">misc - voices</a></li></ul></li><li class="chapter"data-level="3.4"><span>HackIT</span><ul class="articles"><li class="chapter"data-level="3.4.1"data-path="../../../HackIT/coffee_overflow/"><a href="../../../HackIT/coffee_overflow/">rev - coffee_overflow</a></li></ul></li><li class="header">My Tasks</li><li class="header">2018</li><li class="chapter"data-level="5.1"><span>AIS3 Final</span><ul class="articles"><li class="chapter"data-level="5.1.1"data-path="../../../../../tasks/2018/ais3Final/crypto/100-mama/"><a href="../../../../../tasks/2018/ais3Final/crypto/100-mama/">crypto - mama</a></li><li class="chapter"data-level="5.1.2"data-path="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/"><a href="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/">crypto - secureSub</a></li><li class="chapter"data-level="5.1.3"data-path="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/"><a href="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/">crypto - xorlnarmoni'akda</a></li><li class="chapter"data-level="5.1.4"data-path="../../../../../tasks/2018/ais3Final/rev/100-SecDES/"><a href="../../../../../tasks/2018/ais3Final/rev/100-SecDES/">rev - SecDES</a></li><li class="chapter"data-level="5.1.5"data-path="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/"><a href="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/">rev - Almighty Duct Tape</a></li></ul></li><li class="divider"></li><li><a href="https://www.gitbook.com"class="gitbook-link"target="blank">Published with GitBook</a></li></ul></nav></div><div class="book-body"><div class="body-inner"><div class="book-header"role="navigation"><h1><i class="fa fa-circle-o-notch fa-spin"></i> <a href="../../../../..">crypto - secure_hash_v2</a></h1></div><div class="page-wrapper"role="main"tabindex="-1"><div class="page-inner"><div id="book-search-results"><div class="search-noresults"><section class="markdown-section normal"><div class="wpHeaderContainer"><h1 id="securehash-v2">secure_hash v2</h1><div><span><a href="https://github.com/sasdf/ctf-tasks-writeup/blob/master/writeup/2018/HackOver/crypto/secure_hash_v2"target="_blank"><img alt="Attachments"src="https://img.shields.io/badge/-Attachments-lightgrey.svg?style=for-the-badge&amp;maxAge=3600&amp;logo=github"></a></span><span><img alt="crypto - 488"src="https://img.shields.io/badge/crypto-488-green.svg?style=for-the-badge&amp;maxAge=3600"> </span><span><img alt="10 solves"src="https://img.shields.io/badge/solves-10-blue.svg?style=for-the-badge&amp;maxAge=3600"></span></div></div><p></p><blockquote><p>It has come to our attention that the released version of our SecureHash class was in fact not completely secure. We&apos;re deeply sorry about that, and after whipping our sole developer an appropriate number of times we now proudly present SecureHash v2. It features twice as much security as before, and is now certified to be absolutely free of bugs.</p><p>Update: the binary was compiled with g++ and libstdc++, 64bit</p></blockquote><h2 id="time">Time</h2><p>1 hour</p><h1 id="solution">Solution</h1><h2 id="tldr">TL;DR</h2><ol><li>Calculate the bucket number of<root , pwd=""></root></li><li>Search 1000 credentials has same bucket number and register them.</li><li>Login with<root , pwd=""></root></li></ol><p>The task has two operation, register and login. It store the credential using:</p><pre><code>sha512(sha512(name) + password)
</code></pre><p>As far as I know, no collision attack is available on this kind of digest method. But the server has some interesting code when it search for hash:</p><pre><code class="lang-C++"><span class="hljs-function">auth_result <span class="hljs-title">lookup_keyvalue</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; name, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; password)</span> </span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> digest = sha512sum(name, password);
    <span class="hljs-keyword">size_t</span> bucket = values.bucket(digest);

    <span class="hljs-keyword">auto</span> it = values.begin(bucket), end = values.end(bucket);
    <span class="hljs-keyword">size_t</span> iterations = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">size_t</span> MAX_ITERATIONS = <span class="hljs-number">1000</span>;

    <span class="hljs-keyword">while</span> (it != end) {
        <span class="hljs-keyword">if</span> (*it++ == digest)
            <span class="hljs-keyword">return</span> AUTH_SUCCESS; <span class="hljs-comment">// 1</span>

        <span class="hljs-comment">// Avoid DoS attacks by fixing upper time limit.</span>
        <span class="hljs-keyword">if</span> (iterations++ &gt;= MAX_ITERATIONS)
            <span class="hljs-keyword">return</span> AUTH_TIMEOUT; <span class="hljs-comment">// 2</span>
    }

    <span class="hljs-keyword">return</span> AUTH_FAILURE; <span class="hljs-comment">// 0</span>
}
...
            <span class="hljs-keyword">if</span> (table.lookup_keyvalue(name, password)) {
                <span class="hljs-comment">// login successfully, check root and print flag</span>
...
</code></pre><p>We can login when it reach the limit of iterations, Search for 1000 credentials with same bucket number as <code>root, pwd</code>, register them and login with <code>root, pwd</code> to get the flag. Here&apos;s the <a href="https://github.com/sasdf/ctf-tasks-writeup/blob/master/writeup/2018/HackOver/crypto/secure_hash_v2/_files/dos.cpp"target="_blank">code</a>.</p></section></div><div class="search-results"><div class="has-results"><h1 class="search-results-title"><span class="search-results-count"></span> results matching "<span class="search-query"></span>"</h1><ul class="search-results-list"></ul></div><div class="no-results"><h1 class="search-results-title">No results matching "<span class="search-query"></span>"</h1></div></div></div></div></div></div><a href="../oblivious/"class="navigation navigation-prev"aria-label="Previous page: crypto - oblivious"><i class="fa fa-angle-left"></i> </a><a href="../../rev/flagmaker/"class="navigation navigation-next"aria-label="Next page: rev - flagmaker"><i class="fa fa-angle-right"></i></a></div><script>var gitbook=gitbook||[];gitbook.push(function(){gitbook.page.hasChanged({page:{name:"secure_hash v2",category:"crypto",points:488,solves:10,title:"crypto - secure_hash_v2",level:"3.1.2",depth:2,next:{title:"rev - flagmaker",level:"3.1.3",depth:2,path:"writeup/2018/HackOver/rev/flagmaker/README.md",ref:"writeup/2018/HackOver/rev/flagmaker/README.md",articles:[]},previous:{title:"crypto - oblivious",level:"3.1.1",depth:2,path:"writeup/2018/HackOver/crypto/oblivious/README.md",ref:"writeup/2018/HackOver/crypto/oblivious/README.md",articles:[]},dir:"ltr"},config:{gitbook:"*",theme:"default",variables:{},plugins:["katex@git://github.com/sasdf/plugin-katex.git","disqus","html-minifier","writeup-utils@git://github.com/sasdf/gitbook-plugin-writeup-utils.git"],pluginsConfig:{disqus:{useIdentifier:!1,shortName:"sasdfwriteup"},search:{},"html-minifier":{customAttrSurround:[],removeScriptTypeAttributes:!1,removeEmptyAttributes:!1,removeRedundantAttributes:!1,removeEmptyElements:!1,sortClassName:!0,caseSensitive:!0,html5:!0,collapseWhitespace:!0,processConditionalComments:!1,quoteCharacter:null,keepClosingSlash:!0,preventAttributesEscaping:!1,minifyURLs:!1,removeAttributeQuotes:!1,decodeEntities:!1,trimCustomFragments:!1,customAttrAssign:[],includeAutoGeneratedTags:!0,collapseInlineTagWhitespace:!1,collapseBooleanAttributes:!0,minifyJS:!0,removeTagWhitespace:!0,preserveLineBreaks:!1,sortAttributes:!0,removeStyleLinkTypeAttributes:!1,removeComments:!0,minifyCSS:!0,processScripts:[],conservativeCollapse:!1,removeOptionalTags:!1,useShortDoctype:!1},lunr:{maxIndexSize:1e6,ignoreSpecialCharacters:!1},katex:{},fontsettings:{theme:"white",family:"sans",size:2},highlight:{},sharing:{facebook:!0,twitter:!0,google:!1,weibo:!1,instapaper:!1,vk:!1,all:["facebook","google","twitter","weibo","instapaper"]},"theme-default":{styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"},showLevel:!1},"writeup-utils":{filePrefix:"https://github.com/sasdf/ctf-tasks-writeup/blob/master",repoPrefix:"https://github.com/sasdf/ctf-tasks-writeup/blob/master"}},structure:{langs:"LANGS.md",readme:"README.md",glossary:"GLOSSARY.md",summary:"SUMMARY.md"},pdf:{pageNumbers:!0,fontSize:12,fontFamily:"Arial",paperSize:"a4",chapterMark:"pagebreak",pageBreaksBefore:"/",margin:{right:62,left:62,top:56,bottom:56}},styles:{website:"styles/website.css",pdf:"styles/pdf.css",epub:"styles/epub.css",mobi:"styles/mobi.css",ebook:"styles/ebook.css",print:"styles/print.css"}},file:{path:"writeup/2018/HackOver/crypto/secure_hash_v2/README.md",mtime:"2018-10-12T20:27:00.448Z",type:"markdown"},gitbook:{version:"3.2.3",time:"2018-10-12T20:57:02.219Z"},basePath:"../../../../..",book:{language:""}})})</script></div><script src="../../../../../gitbook/gitbook.js"></script><script src="../../../../../gitbook/theme.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-disqus/plugin.js"></script><script src="../../../../../gitbook/gitbook-plugin-search/search-engine.js"></script><script src="../../../../../gitbook/gitbook-plugin-search/search.js"></script><script src="../../../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script><script src="../../../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script><script src="../../../../../gitbook/gitbook-plugin-sharing/buttons.js"></script><script src="../../../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script></body></html>