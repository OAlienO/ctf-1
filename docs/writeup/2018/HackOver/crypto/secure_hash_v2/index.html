
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>crypto - secure_hash_v2 Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../../../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-disqus/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-writeup-utils/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../../../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../../../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../../../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../../rev/flagmaker/" />
    
    
    <link rel="prev" href="../oblivious/" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../../../../">
            
                <a href="../../../../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Writeups</li>
        
        
    

    
        
        <li class="header">2018</li>
        
        
    
        <li class="chapter " data-level="3.1" >
            
                <span>
            
                    
                    Hackover
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../oblivious/">
            
                <a href="../oblivious/">
            
                    
                    crypto - oblivious
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="3.1.2" data-path="./">
            
                <a href="./">
            
                    
                    crypto - secure_hash_v2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../rev/flagmaker/">
            
                <a href="../../rev/flagmaker/">
            
                    
                    rev - flagmaker
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" >
            
                <span>
            
                    
                    Teaser Dragon
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" data-path="../../../TeaserDragon/rev/Chains of trust/">
            
                <a href="../../../TeaserDragon/rev/Chains of trust/">
            
                    
                    rev - Chains of trust
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.3" >
            
                <span>
            
                    
                    Defcamp
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.3.1" data-path="../../../defcamp/rev/validator/">
            
                <a href="../../../defcamp/rev/validator/">
            
                    
                    rev - validator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.2" data-path="../../../defcamp/rev/memsome/">
            
                <a href="../../../defcamp/rev/memsome/">
            
                    
                    rev - memsome
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.3" data-path="../../../defcamp/web/secops/">
            
                <a href="../../../defcamp/web/secops/">
            
                    
                    web - secops
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.4" data-path="../../../defcamp/web/chat/">
            
                <a href="../../../defcamp/web/chat/">
            
                    
                    web - chat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3.5" data-path="../../../defcamp/misc/voices/">
            
                <a href="../../../defcamp/misc/voices/">
            
                    
                    misc - voices
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.4" >
            
                <span>
            
                    
                    HackIT
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.4.1" data-path="../../../HackIT/coffee_overflow/">
            
                <a href="../../../HackIT/coffee_overflow/">
            
                    
                    rev - coffee_overflow
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">My Tasks</li>
        
        
    

    
        
        <li class="header">2018</li>
        
        
    
        <li class="chapter " data-level="5.1" >
            
                <span>
            
                    
                    AIS3 Final
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="5.1.1" data-path="../../../../../tasks/2018/ais3Final/crypto/100-mama/">
            
                <a href="../../../../../tasks/2018/ais3Final/crypto/100-mama/">
            
                    
                    crypto - mama
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.2" data-path="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/">
            
                <a href="../../../../../tasks/2018/ais3Final/crypto/300-xorlnarmoni'akda/">
            
                    
                    crypto - xorlnarmoni'akda
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.3" data-path="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/">
            
                <a href="../../../../../tasks/2018/ais3Final/crypto/200-secureSub/">
            
                    
                    crypto - secureSub
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.4" data-path="../../../../../tasks/2018/ais3Final/rev/100-SecDES/">
            
                <a href="../../../../../tasks/2018/ais3Final/rev/100-SecDES/">
            
                    
                    rev - SecDES
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.1.5" data-path="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/">
            
                <a href="../../../../../tasks/2018/ais3Final/rev/200-AlmightyDuctTape/">
            
                    
                    rev - Almighty Duct Tape
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../../../.." >crypto - secure_hash_v2</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>
                <div class="wpHeaderContainer">
                    <h1 id="securehash-v2">secure_hash v2</h1>
                        <span>
                            <a href="https://github.com/sasdf/ctf-tasks-writeup/blob/master/writeup/2018/HackOver/crypto/secure_hash_v2" target="_blank"><img src="https://img.shields.io/badge/-Attachments-lightgrey.svg?style=for-the-badge&amp;maxAge=3600&amp;logo=github" alt="Attachments"></a>
                        </span>
                        <span>
                            <img src="https://img.shields.io/badge/crypto-488-green.svg?style=for-the-badge&amp;maxAge=3600" alt="crypto - 488">
                        </span>
                        <span>
                            <img src="https://img.shields.io/badge/solves-10-blue.svg?style=for-the-badge&amp;maxAge=3600" alt="10 solves">
                        </span>
                </div>
                </p>
<blockquote>
<p>It has come to our attention that the released version of our
SecureHash class was in fact not completely secure.
We&apos;re deeply sorry about that,
and after whipping our sole developer an appropriate number of
times we now proudly present SecureHash v2.
It features twice as much security as before,
and is now certified to be absolutely free of bugs.</p>
<p>Update: the binary was compiled with g++ and libstdc++, 64bit</p>
</blockquote>
<h2 id="time">Time</h2>
<p>1 hour</p>
<h1 id="solution">Solution</h1>
<h2 id="tldr">TL;DR</h2>
<ol>
<li>Calculate the bucket number of <root, pwd=""></root,></li>
<li>Search 1000 credentials has same bucket number and register them.</li>
<li>Login with <root, pwd=""></root,></li>
</ol>
<p>The task has two operation, register and login.
It store the credential using:</p>
<pre><code>sha512(sha512(name) + password)
</code></pre><p>As far as I know, no collision attack is available on this kind of digest method.
But the server has some interesting code when it search for hash:</p>
<pre><code class="lang-C++"><span class="hljs-function">auth_result <span class="hljs-title">lookup_keyvalue</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; name, <span class="hljs-keyword">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; password)</span> </span>{
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> digest = sha512sum(name, password);
    <span class="hljs-keyword">size_t</span> bucket = values.bucket(digest);

    <span class="hljs-keyword">auto</span> it = values.begin(bucket), end = values.end(bucket);
    <span class="hljs-keyword">size_t</span> iterations = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">size_t</span> MAX_ITERATIONS = <span class="hljs-number">1000</span>;

    <span class="hljs-keyword">while</span> (it != end) {
        <span class="hljs-keyword">if</span> (*it++ == digest)
            <span class="hljs-keyword">return</span> AUTH_SUCCESS; <span class="hljs-comment">// 1</span>

        <span class="hljs-comment">// Avoid DoS attacks by fixing upper time limit.</span>
        <span class="hljs-keyword">if</span> (iterations++ &gt;= MAX_ITERATIONS)
            <span class="hljs-keyword">return</span> AUTH_TIMEOUT; <span class="hljs-comment">// 2</span>
    }

    <span class="hljs-keyword">return</span> AUTH_FAILURE; <span class="hljs-comment">// 0</span>
}
...
            <span class="hljs-keyword">if</span> (table.lookup_keyvalue(name, password)) {
                <span class="hljs-comment">// login successfully, check root and print flag</span>
...
</code></pre>
<p>We can login when it reach the limit of iterations,
Search for 1000 credentials with same bucket number as <code>root, pwd</code>,
register them and login with <code>root, pwd</code> to get the flag.
Here&apos;s the <a href="https://github.com/sasdf/ctf-tasks-writeup/blob/master/writeup/2018/HackOver/crypto/secure_hash_v2/_files/dos.cpp" target="_blank">code</a>.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="../oblivious/" class="navigation navigation-prev " aria-label="Previous page: crypto - oblivious">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../../rev/flagmaker/" class="navigation navigation-next " aria-label="Next page: rev - flagmaker">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"crypto - secure_hash_v2","level":"3.1.2","depth":2,"next":{"title":"rev - flagmaker","level":"3.1.3","depth":2,"path":"writeup/2018/HackOver/rev/flagmaker/README.md","ref":"writeup/2018/HackOver/rev/flagmaker/README.md","articles":[]},"previous":{"title":"crypto - oblivious","level":"3.1.1","depth":2,"path":"writeup/2018/HackOver/crypto/oblivious/README.md","ref":"writeup/2018/HackOver/crypto/oblivious/README.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["katex@git://github.com/sasdf/plugin-katex.git","disqus","writeup-utils@git://github.com/sasdf/gitbook-plugin-writeup-utils.git"],"pluginsConfig":{"disqus":{"useIdentifier":false,"shortName":"sasdfwriteup"},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"writeup-utils":{"filePrefix":"https://github.com/sasdf/ctf-tasks-writeup/blob/master","repoPrefix":"https://github.com/sasdf/ctf-tasks-writeup/blob/master"}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"writeup/2018/HackOver/crypto/secure_hash_v2/README.md","mtime":"2018-10-12T18:14:11.992Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-12T18:19:44.840Z"},"basePath":"../../../../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../../../../gitbook/gitbook.js"></script>
    <script src="../../../../../gitbook/theme.js"></script>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.16.1/URI.min.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-disqus/plugin.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../../../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

